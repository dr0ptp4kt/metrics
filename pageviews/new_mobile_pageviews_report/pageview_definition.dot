
/* 
   You can convert this graph to a PNG image with this command:

   dot -Tpng  Pageview_definition.dot  -o Pageview_definition.png

*/


digraph G {

     Legend [shape=none, margin="0,0", width=1, label=<
     <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" CELLPADDING="4">
      <TR>
       <TD><B>Legend</B></TD>
      </TR>
      <TR>
       <TD bgcolor="CornflowerBlue">Start state</TD>
      </TR>
      <TR>
       <TD bgcolor="red">Rejected state</TD>
      </TR>
      <TR>
       <TD bgcolor="green">Accepted state</TD>
      </TR>
      <TR>
       <TD bgcolor="gold">Decision state</TD>
      </TR>
     </TABLE>
    >];

   Squid_log_line       [label="Get a squid log line",style=filled,color="CornflowerBlue" ];
   decision_status_code [label="status code is 30x/20x ?",style=filled,color="Gold"];
   decision_mimetype    [label="mimetype is \"-\" or \"text/html\"",style=filled,color="Gold"];
   decision_no_bots     [label="ip isn't in bot ranges and UA doesn't contain\n \"bot\" or \"crawler\" or \"google\" ?",style=filled,color="Gold"];
   decision_url         [label="url is like\nhttp(s)://(wikiproject).m.wikipedia.org/wiki/....\nhttp(s)://(wikiproject).m.wikipedia.org/w/index.php?....\nhttp(s)://(wikiproject).m.wikipedia.org/w/api.php?....",
                         style=filled,color="Gold"
                        ];
   discard              [label="entry is discarded",style=filled,color="Red"];
   Actual_pageview      [label="We have a pageview",style=filled,color="Green"];


   Squid_log_line       -> decision_status_code
   decision_status_code -> decision_url      [ label="yes" ];
   decision_status_code -> discard           [ label="no" ];

   decision_url         -> decision_mimetype [ label="yes"];
   decision_url         -> discard           [ label="no"];

   decision_mimetype    -> decision_no_bots  [label="yes"];
   decision_mimetype    -> discard           [label="no"];

   decision_no_bots     -> Actual_pageview   [label="yes"];
   decision_no_bots     -> discard           [label="no"];

};
